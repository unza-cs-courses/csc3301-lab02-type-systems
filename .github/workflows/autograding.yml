name: Autograder

on: [push]

jobs:
  grade:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4

    - uses: actions/setup-python@v5
      with:
        python-version: '3.11'

    - name: Install dependencies
      run: pip install pytest mypy flake8

    - name: Check variant configuration
      run: |
        if [ -f ".variant_config.json" ]; then
          echo "Variant configuration found"
          cat .variant_config.json | head -20
        else
          echo "No variant configuration found - using defaults"
        fi

    - name: Run visible tests
      run: pytest tests/visible/ -v --tb=short

    - name: Run mypy type checking (Task 1)
      run: mypy src/task1_annotations.py --strict || echo "mypy check completed with errors"
      continue-on-error: true

    - name: Run all tests
      run: pytest tests/ -v
